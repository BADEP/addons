<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<!-- FILTERS -->
		<record id="view_offer_filter" model="ir.ui.view">
			<field name="name">offer</field>
			<field name="model">project.offer</field>
			<field name="arch" type="xml">
				<search string="offers">
					<filter domain="[('state','=','open')]" string="In Position"/>
					<field name="host"/>
					<group expand="0" string="Group By">
						
					</group>
				</search>
			</field>
		</record>
   
		<record id="view_project_submission_filter" model="ir.ui.view">
			<field name="name">Soumissions</field>
			<field name="model">project.submission</field>
			<field name="arch" type="xml">
				<search string="Rechercher les soumissions">
					<field name="candidate" filter_domain="['|','|',('name','ilike',self),('candidate','ilike',self),('email_from','ilike',self)]" string="Candidat"/>
					<filter string="My" domain="[('manager', '=', uid)]"/>
					<filter string="Non assigné" domain="[('manager', '=', False)]"/>
					<separator/>
					<filter string="Next Actions" context="{'invisible_next_action':False, 'invisible_next_date':False}"
						domain="[('date_action','&lt;&gt;',False)]" help="Filter and view on next actions and date"/>
					<separator/>
					<filter string="New Mail" name="message_unread" domain="[('message_unread','=',True)]"/>
					<field name="offer"/>
					<field name="field"/>
					<field name="manager"/>
					<separator/>
					<field name="candidate"/>
					<separator/>
					<group expand="0" string="Group By">
						<filter string="Etat" domain="[]"  context="{'group_by':'state'}"/>
						<filter string="Responsable" domain="[]"  context="{'group_by':'manager'}"/>
						<filter string="Offre" domain="[]" context="{'group_by':'offer'}"/>
						<filter string="Thématique" domain="[]" context="{'group_by':'field'}"/>
					</group>
			   </search>
			</field>
		</record>

		<!-- KANBAN -->
		<record id="view_project_offer_kanban" model="ir.ui.view">
			<field name="name">project.offer.kanban</field>
			<field name="model">project.offer</field>
			<field name="arch" type="xml">
				<kanban class="oe_background_grey" default_group_by="state">
					<field name="name"/>
					<field name="type"/>
					<field name="submissions_count"/>
					<field name="color"/>
					<field name="submissions"/>
					<field name="documents"/>
					<field name="accepted_count"/>
					<field name="manager"/>
					<field name="state"/>
					<templates>
						<t t-name="kanban-box">
							<div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_job oe_kanban_card oe_kanban_global_click">
								<div class="oe_dropdown_toggle oe_dropdown_kanban oe_custom">
									<span class="oe_e">í</span>
									<ul class="oe_dropdown_menu">
										<t t-if="widget.view.is_action_enabled('edit')">
											<li><a type="edit">Edit...</a></li>
										</t>
										<t t-if="widget.view.is_action_enabled('delete')">
											<li><a type="delete">Delete</a></li>
										</t>
										<li><ul class="oe_kanban_colorpicker" data-field="color"/></li>
									</ul>
								</div>
								<div class="oe_kanban_content">
									<t t-if="record.manager.raw_value">
										<img t-att-src="kanban_image('res.partner', 'image_medium', record.manager.raw_value[0])" t-att-title="record.manager.value" class="oe_kanban_avatar oe_job_avatar"/>
									</t>
									<t t-if="record.manager.raw_value === false">
										<img t-att-src='_s + "/base/static/src/img/avatar.png"' class="oe_kanban_avatar oe_job_avatar"/>
									</t>
									<div class="oe_job_detail">
										<div class="text-center oe_job oe_name oe_kanban_ellipsis">
											<field name="name"/>
										</div>
										<div class="text-center oe_job oe_department oe_kanban_ellipsis">
											<strong><field name="type"/>
											<span t-if="record.manager.value" class="oe_manager_name">
											</span></strong>
										</div>
									</div>
									<t t-if="record.state.raw_value == 'open'">
										<div class="oe_applications">
											<a name="%(action_project_submission)d" t-attf-data-context="{'search_default_offer': [{{record.id.raw_value}}], 'default_offer': {{record.id.raw_value}}}" type="action">
												<span><t t-esc="record.submissions.raw_value.length"/> Soumissions</span>
											</a>
											<br/>
											<a t-if="record.documents.raw_value.length gt 0" name="action_get_attachment_tree_view" type="object">
												<span t-if="record.documents.raw_value.length gt 1"><t t-esc="record.documents.raw_value.length"/> Documents</span>
												<span t-if="record.documents.raw_value.length lt 2"><t t-esc="record.documents.raw_value.length"/> Document</span>
											</a>
										</div>
										<div class="oe_job_justgage">
											<field state="open" name="accepted_count" widget="gauge"
												style="margin-top:7px; width:160px; height: 120px;"
												options="{
													'max_field': 'submissions_count',
													'label': 'Soumissions acceptées',
													'force_set': False,
													'gauge_value_field': 'submissions_count',
												}">
												Soumissions acceptées
											</field>
										</div>
									</t>
									<t t-if="record.state.raw_value == 'draft'">
										<div class="oe_start_recruitment">
											<p><b>Cliquez ici</b> pour lancer l'offre</p>
											<img src="/hr_recruitment/static/src/img/down1.png"/>
										</div>
									</t>
									<div class="oe_launch_recruitment">
										<a t-if="record.state.raw_value == 'draft'" data-name="action_open" data-type="object" class="oe_kanban_action">Lancer l'offre</a>
										<a t-if="record.state.raw_value == 'open'" data-name="action_close" data-type="object" class="oe_kanban_action">Clôturer l'offre</a>
									</div>
								</div>
							</div>
						</t>
					</templates>
				</kanban>
			</field>
		</record>
		
		<record model="ir.ui.view" id="view_project_submission_kanban">
			<field name="name">Project Submission kanban</field>
			<field name="model">project.submission</field>
			<field name="arch" type="xml">
				<kanban default_group_by="state">
					<field name="state"/>
					<field name="color"/>
					<field name="manager"/>
					<field name="field"/>
					<field name="offer"/>
					<field name="title_action"/>
					<field name="date_submitted"/>
					<field name="date_processed"/>
					<field name="date_action"/>
					<field name="project"/>
					<field name="budget"/>
					<field name="documents_count"/>
					<field name="candidate"/>
					<field name="message_summary"/>
					<field name="priority"/>
					<field name="partner_mobile"/>
				   
			   		<templates>
			   		
			   			<t t-name="kanban-tooltip">
							<ul class="oe_kanban_tooltip">
								<li t-if="record.field.raw_value"><b>Domaines:</b> <field name="field"/></li>
								<li t-if="record.candidate.raw_value"><b>Contact:</b> <field name="candidate"/></li>
								<li t-if="record.state.raw_value"><b>State:</b> <field name="state"/></li>
							</ul>
						</t>
						<t t-name="kanban-box">
							<div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_global_click oe_semantic_html_override">
								<div class="oe_dropdown_toggle oe_dropdown_kanban">
									<span class="oe_e">i</span>
									<ul class="oe_dropdown_menu">
										<t t-if="widget.view.is_action_enabled('delete')"><li><a type="delete">Delete</a></li></t>
										<li><a name="action_makeMeeting" type="object">Schedule Interview</a></li>
										<li><ul class="oe_kanban_colorpicker" data-field="color"/></li>
									</ul>
	
								</div>
								
								<div class="oe_kanban_content" tooltip="kanban-tooltip">
									<div>
										<!--<t t-if="record.partner_name.raw_value"><b><field name="partner_name"/></b><br/></t>-->
										<i><field name="name"/></i><br/>
										<field name="offer"/><br/>
										<t t-if="record.partner_mobile.raw_value">Mobile: <field name="partner_mobile"/><br/></t>
									</div>
									<div style="padding-left: 0.5em">
										<t t-if="record.date_action.raw_value and record.date_action.raw_value lt (new Date())" t-set="red">oe_kanban_text_red</t>
										<span t-attf-class="#{red || ''}"><field name="date_action"/></span>
											<t t-if="record.date_action.raw_value"> : </t>
											<field name="title_action"/>
									</div>
									<div style="width:240px"><field name="field"/></div>
									<div class="oe_kanban_bottom_right">
										<img t-att-src="kanban_image('res.users', 'image_small', record.manager.raw_value)" t-att-title="record.manager.value" width="24" height="24" class="oe_kanban_avatar pull-right"/>
										<div class="pull-left" groups="base.group_user">
											<field name="priority" widget="priority"/>
										</div>
									</div>
									<div class="oe_kanban_footer_left" style="margin-top:5px;">
										<t t-raw="record.message_summary.raw_value"/>
										<a t-if="record.documents_count" name="action_get_attachment_tree_view" type="object" style="margin-right: 10px"> <field name="documents_count"/> Documents</a>
									</div>
	
								</div>
								<div class="oe_clear"></div>
							</div>
						</t>
			   		</templates>
				</kanban>
			</field>
		</record>

		<record model="ir.ui.view" id="view_project_candidate_kanban">
			<field name="name">project.candidate.kanban</field>
			<field name="model">project.candidate</field>
			<field name="mode">primary</field>
			<field name="inherit_id" ref="base.res_partner_kanban_view"></field>
			<field name="arch" type="xml">
				<data></data>
			</field>
		</record>

		<!-- FORMS -->	
		<record id="view_project_submission_form" model="ir.ui.view">
			<field name="name">project.submission.form</field>
			<field name="model">project.submission</field>
			<field name="arch" type="xml">
				<form string="Soumission">
				<header>
					<field name="state" widget="statusbar"/>
				</header>
					<sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name" class="oe_inline"/></h1>
                        </div>
						<div class="oe_right" name="buttons">
							<div class="oe_button_box">
								<button class="oe_stat_button" icon="fa-book" name="action_get_attachment_tree_view" type="object">
									<field name="documents_count" widget="statinfo" string="Documents"/>
								</button>
								<button name="action_start_survey" attrs="{'invisible': [('survey','=',False)]}" class="oe_stat_button" icon="fa-user" type="object" help="Answer related job question">
									<div>Start<br/>Interview</div>
								</button>
								<button name="action_print_survey" attrs="{'invisible': [('survey','=',False)]}" class="oe_stat_button" icon="fa-print" type="object" help="Print interview report">
									<div>Print<br/>Interview</div>
								</button>
							</div>
						</div>
						<group>
						  	<group>
								<field name="acronyme"/>
								<field name="offer"/>
								<field name="candidate"/>
								<field name="partner_mobile"/>
								<field name="organisme"/>
								<field name="manager"/>
							</group>
					 	 	<group>
					 	 		<field name="date_submitted" readonly="1" attrs="{'invisible': [('state','=','draft')]}"/>
								<field name="date_processed" readonly="1" attrs="{'invisible': [('state','in',['draft', 'submitted'])]}"/>
								<field name="priority" widget="priority"/>
								<field name="title_action"/>
								<field name="date_action"/>
								<field name="project" attrs="{'invisible': [('state','!=','accepted')]}"/>
							</group>
						</group>
						<group string="Informations générales">
							<group colspan="2">
								<field name="description"/>
								<field name="partners">
									<tree>
										<field name="category"/>
										<field name="name"/>
										<field name="mobile"/>
										<field name="email"/>
									</tree>
								</field>
							</group>
							<group>
								<field name="field" widget="many2many_tags"/>
								<field name="duration"/>
							</group>
							<group>
								<field name="survey" invisible="1"/>
								<field name="response"/>
							</group>
						</group>
						<group colspan="2" string="Informations financières">
							<group>
								<field name="budget"/>
								<field name="montant_propre"/>
							</group>
							<group>
								<field name="montant_subventionne"/>
								<field name="percent_subventionne"/>
							</group>
							<group colspan="2" string="Répartition financière">
								<field name="budget_lines">
									<tree editable="bottom">
										<field name="type"/>
										<field name="budget"/>
										<field name="montant_propre"/>
										<field name="montant_subventionne"/>
										<field name="percent_subventionne"/>
									</tree>
								</field>
							</group>
							<group colspan="2" string="Personnel">
								<field name="personnels">
									<tree editable="bottom">
										<field name="type"/>
										<field name="function"/>
										<field name="number"/>
										<field name="time"/>
										<field name="montant"/>
										<field name="total"/>
									</tree>
								</field>
							</group>
						</group>
						<group colspan="2" string="Tâches et livrables">
							<field name="tasks">
								<tree>
									<field name="type"/>
									<field name="semester"/>
									<field name="partner"/>
									<field name="partners"/>
									<field name="objectives"/>
									<field name="description"/>
									<field name="lots" widget="many2many_tags"/>
								</tree>
								<form>
									<group>
									<field name="type"/>
									<field name="semester"/>
									<field name="submission" invisible="1"/>
									<field name="possible_values" invisible="1"/>
									<field name="partner"/>
									<field name="partners"/>
									<field name="objectives"/>
									<field name="description"/>
									<field name="lots">
										<tree editable="bottom">
											<field name="type"/>
											<field name="name"/>
											<field name="month_due"/>
										</tree>
									</field></group>
								</form>
							</field>
						</group>
					</sheet>
				</form>
			</field>
		</record>

		<record id="view_project_offer_form" model="ir.ui.view">
			<field name="name">project.offer.form</field>
			<field name="model">project.offer</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="project offer">
					<header>
						<button name="action_open" string="Lancer l'offre" states="draft" type="object" class="oe_highlight" groups="base.group_user"/>
						<button name="action_close" string="Clôturer l'offre" states="open,done" type="object" class="oe_highlight" groups="base.group_user"/>
						<field name="state" widget="statusbar" statusbar_visible="draft,open,done,closed"/>
					</header>
				
					<sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name" class="oe_inline"/></h1>
                            <field name="description"/>
                        </div>
						<div class="oe_right" name="buttons">
							<div class="oe_button_box">
								<button class="oe_stat_button" icon="fa-file-o" name="%(action_project_submission)d" context="{'search_default_offer': [active_id], 'default_offer': active_id}" type="action">
									<field name="submissions_count" widget="statinfo" string="Soumissions"/>
								</button>
								<button class="oe_stat_button" icon="fa-book" name="action_get_attachment_tree_view" type="object">
									<field name="documents_count" widget="statinfo" string="Documents"/>
								</button>
							</div>
						</div>
					  	<group>
                            <field name="description"/>
					  		<group>
								<field name="manager"/>
								<field name="type"/>
								<field name="host"/>
								<field name="budget_total"/>
								<field name="min_time"/>
								<field name="max_time"/>
							</group>
						  	<group>
								<field name="date_open"/>
								<field name="date_closed"/>
								<field name="accepted_count"/>
								<field name="survey" attrs="{'required': [('state','!=','draft')]}" class="oe_inline" domain="[('res_model','=','project_offer')]"/>
	   							<button string="Print Interview" name="action_print_survey" type="object" attrs="{'invisible':[('survey','=',False)]}" class="oe_inline oe_link"/>
							</group>
						</group>
					</sheet>
				
		            <div class="oe_chatter">
		                <field name="message_follower_ids" widget="mail_followers"/>
		                <field name="message_ids" widget="mail_thread"/>
		            </div>
				</form>
			</field>
		</record>
	
		<record id="view_project_candidate_form" model="ir.ui.view">
		<field name="name">project.candidate.form</field>
		<field name="model">project.candidate</field>
		<field name="mode">primary</field>
		<field name="inherit_id" ref="base.view_partner_form"/>
		<field name="arch" type="xml">
			<data>
				<div name="buttons" position="before">
					<div name="button_reset" class="oe_right oe_button_box">
						<button string="Réinitialiser le mot de passe" class="oe_link" type="object" name="action_reset_password"/>
					</div>
					<div name="buttons_submission" class="oe_right oe_button_box">
						<button class="oe_stat_button" icon="fa-file-o" name="%(action_project_submission)d" context="{'search_default_candidate': [active_id], 'default_candidate': active_id}" type="action">
							 <field name="submissions_count" widget="statinfo" string="Soumissions"/>
						</button>
						<button class="oe_stat_button" icon="fa-book" name="action_get_attachment_tree_view" type="object">
							<field name="documents_count" widget="statinfo" string="Documents"/>
						</button>
					</div>
				</div>
				<field name="name" position="after">
					<field name="login" placeholder="Login"/>
				</field>
				<field name="user_id" position="replace"/>
				<xpath expr="//page[@name='sales_purchases']//field[@name='customer']" position="attributes">
					<attribute name="invisible">1</attribute>
				</xpath>
				<xpath expr="//page[@name='sales_purchases']//field[@name='supplier']" position="attributes">
	 			 	<attribute name="invisible">1</attribute>
				</xpath>
			   </data>
		</field>
	</record>
	
		<record id="view_project_request_form" model="ir.ui.view">
		<field name="name">project.offer.type.form</field>
		<field name="model">project.offer.type</field>
		<field name="arch" type="xml">
			<form string="Types Offre">
				<sheet>
					<field name="name"/>
					<!-- <field name="note"/>-->
				</sheet>
			</form>
		</field>
	</record>

		<!-- ACTIONS -->
		<record id="action_project_offer" model="ir.actions.act_window">
			<field name="name">Offres</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.offer</field>
			<field name="view_type">form</field>
			<field name="view_mode">kanban,tree,form</field>
		</record>
	 	<record id="action_project_submission" model="ir.actions.act_window">
			<field name="name">Soumissions</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.submission</field>
			<field name="view_type">form</field>
			<field name="view_mode">kanban,tree,form</field>
		</record>
		<record id="action_project_candidate" model="ir.actions.act_window">
			<field name="name">Candidats</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.candidate</field>
			<field name="view_type">form</field>
			<field name="view_mode">kanban,tree,form</field>
		</record>
	   	<record id="action_project_request" model="ir.actions.act_window">
			<field name="name">Demandes de ressources</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.request</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>

		<record id="action_project_offer_type" model="ir.actions.act_window">
			<field name="name">Types d'offre</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.offer.type</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>
		<record id="action_project_offer_field" model="ir.actions.act_window">
			<field name="name">Thématique</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.offer.field</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>
		<record id="action_project_budgetline_type" model="ir.actions.act_window">
			<field name="name">Types de lignes de budget</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.budgetline.type</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>
		<record id="action_project_request_type" model="ir.actions.act_window">
			<field name="name">Types d'offre</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.request.type</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>
		<record id="action_project_partner_function" model="ir.actions.act_window">
			<field name="name">Titres</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.partner.function</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>
		<record id="action_project_submission_task_type" model="ir.actions.act_window">
			<field name="name">Types d'activité</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.submission.task.type</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>
		<record id="action_project_lot_type" model="ir.actions.act_window">
			<field name="name">Types de livrable</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">project.lot.type</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>

		<!-- MENUS -->
		<menuitem id="menu_project_submission_root" name="Appels à projets" sequence="10"/>

		<menuitem id="menu_project_submission_main" name="Appels à projets" parent="project_submission.menu_project_submission_root" sequence="0"/>
		<menuitem id="menu_project_submission_config" name="Configuration" parent="project_submission.menu_project_submission_root" sequence="10"/>

		<menuitem id="menu_project_offer" name="Offres" action="action_project_offer" parent="project_submission.menu_project_submission_main" sequence="0"/>
		<menuitem id="menu_project_submission" name="Soumissions" action="action_project_submission" parent="project_submission.menu_project_submission_main" sequence="10"/>
		<menuitem id="menu_project_candidate" name="Candidats" action="action_project_candidate" parent="project_submission.menu_project_submission_main" sequence="20"/>
		<!-- <menuitem id="menu_project_request" name="Demandes de ressources" action="action_project_request" parent="project_submission.menu_project_submission_main" sequence="20"/>
 -->
		<menuitem id="menu_project_offer_type" name="Types d'offres" action="action_project_offer_type" parent="project_submission.menu_project_submission_config" sequence="0"/>
		<menuitem id="menu_project_offer_field" name="Thématiques" action="action_project_offer_field" parent="project_submission.menu_project_submission_config" sequence="10"/>
		<menuitem id="menu_project_partner_function" name="Titres" action="action_project_partner_function" parent="project_submission.menu_project_submission_config" sequence="15"/>
		<menuitem id="menu_project_request_type" name="Types de demandes" action="action_project_request_type" parent="project_submission.menu_project_submission_config" sequence="20"/>
		<menuitem id="menu_project_submission_task_type" name="Types d'activité" action="action_project_submission_task_type" parent="project_submission.menu_project_submission_config" sequence="25"/>
		<menuitem id="menu_project_lot_type" name="Types de livrable" action="action_project_lot_type" parent="project_submission.menu_project_submission_config" sequence="26"/>
		<menuitem id="menu_project_budgetline_type" name="Types de lignes de budget" action="action_project_budgetline_type" parent="project_submission.menu_project_submission_config" sequence="30"/>

	</data>
</openerp>